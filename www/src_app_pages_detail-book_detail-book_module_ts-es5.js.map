{"version":3,"sources":["webpack:///node_modules/@capacitor/share/dist/esm/definitions.js","webpack:///node_modules/@capacitor/share/dist/esm/index.js","webpack:///src/app/pages/detail-book/detail-book-routing.module.ts","webpack:///src/app/pages/detail-book/detail-book.module.ts","webpack:///src/app/pages/detail-book/detail-book.page.ts","webpack:///src/app/services/download-book.service.ts","webpack:///src/app/pages/detail-book/detail-book.page.scss","webpack:///src/app/pages/detail-book/detail-book.page.html"],"names":["Share","registerPlugin","web","then","m","ShareWeb","routes","path","component","DetailBookPage","DetailBookPageRoutingModule","NgModule","imports","RouterModule","exports","DetailBookPageModule","CommonModule","FormsModule","IonicModule","declarations","activatedRoute","router","httpService","domSanitizer","downloadBookService","favorService","toastCtrl","loadingCtrl","alertCtrl","data","myImage","myBook","isLoading","queryParams","subscribe","book","getCurrentNavigation","extras","state","e","console","log","url","create","message","duration","toast","downloadFile","base64","bypassSecurityTrustResourceUrl","present","name","loading","extension","downloadBook","encodeURI","dismiss","Storage","key","TRIAL_KEY","value","JSON","stringify","downloadBookChm","downloadBookEpub","addFavor","text","title","author","language","ActivatedRoute","Router","HttpService","DomSanitizer","DownloadBookService","FavoritesService","ToastController","LoadingController","AlertController","Component","selector","template","BOOK_KEY","http","fileOpener","downloadProgress","myBooks","convertBlobToBase64","blob","Promise","resolve","reject","reader","FileReader","onerror","onload","result","readAsDataURL","proxyUrl","get","responseType","reportProgress","observe","event","type","HttpEventType","Math","round","loaded","total","Date","now","body","Filesystem","directory","Directory","savedFile","uri","mimeType","getMimeType","open","err","unshift","indexOf","HttpClient","FileOpener","Injectable","providedIn"],"mappings":"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","file":"src_app_pages_detail-book_detail-book_module_ts-es5.js","sourcesContent":["export {};\n//# sourceMappingURL=definitions.js.map","import { registerPlugin } from '@capacitor/core';\nconst Share = registerPlugin('Share', {\n    web: () => import('./web').then(m => new m.ShareWeb()),\n});\nexport * from './definitions';\nexport { Share };\n//# sourceMappingURL=index.js.map","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { DetailBookPage } from './detail-book.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: DetailBookPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class DetailBookPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { DetailBookPageRoutingModule } from './detail-book-routing.module';\n\nimport { DetailBookPage } from './detail-book.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    DetailBookPageRoutingModule\n  ],\n  declarations: [DetailBookPage]\n})\nexport class DetailBookPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport {ActivatedRoute, Router} from '@angular/router';\nimport {BookModel, SearchBookModel} from '../../services/library.service';\nimport {HttpService} from '../../services/http.service';\nimport {DomSanitizer} from '@angular/platform-browser';\nimport {DownloadBookService} from '../../services/download-book.service';\nimport {FavoritesService} from '../../services/favorites.service';\nimport {AlertController, LoadingController, ToastController} from '@ionic/angular';\nimport {Share} from '@capacitor/share';\nimport {Storage} from '@capacitor/storage';\nimport {TRIAL_KEY} from '../tutorial/tutorial.page';\n\n@Component({\n  selector: 'app-detail-book',\n  templateUrl: './detail-book.page.html',\n  styleUrls: ['./detail-book.page.scss'],\n})\nexport class DetailBookPage implements OnInit {\n  book: SearchBookModel;\n  data = null;\n  myImage = null;\n  myBook = null;\n  isLoading = false;\n  constructor(private activatedRoute: ActivatedRoute,\n              private router: Router,\n              private httpService: HttpService,\n              private domSanitizer: DomSanitizer,\n              private downloadBookService: DownloadBookService,\n              private favorService: FavoritesService,\n              private toastCtrl: ToastController,\n              private loadingCtrl: LoadingController,\n              private alertCtrl: AlertController) { }\n\n\n   ngOnInit() {\n\n    this.activatedRoute.queryParams.subscribe((book) => {\n      this.isLoading = true;\n      if (this.router.getCurrentNavigation().extras.state.data) {\n        this.book = this.router.getCurrentNavigation().extras.state.data;\n        this.isLoading = false;\n      }\n    }, e => {\n      console.log(e);\n    });\n  }\n\n async downloadFile(url) {\n    const toast = await this.toastCtrl.create({\n      message: 'اشکالی در ارتباط با سرور وجود دارد',\n      duration: 1500\n    });\n    this.httpService.downloadFile(url).then((base64) => {\n      this.myImage = this.domSanitizer.bypassSecurityTrustResourceUrl(base64);\n    }).catch(e => {\n      toast.present();\n    });\n  }\n\n  async download(url, name) {\n    //const trial = await Storage.get({key: TRIAL_KEY});\n    //console.log(JSON.parse(trial.value));\n    //if (JSON.parse(trial.value)) {\n      const loading = await this.loadingCtrl.create({\n        message: 'لطفا منتظر بمانید'\n      });\n      const toast = await this.toastCtrl.create({\n        message: 'اشکالی در ارتباط با سرور وجود دارد',\n        duration: 1500\n      });\n      loading.present();\n      if (this.book.extension == 'pdf') {\n        console.log('pdf');\n        this.httpService.downloadBook(encodeURI(url), name).then(async (base64) => {\n          this.myBook = base64;\n          loading.dismiss();\n          await Storage.set({key: TRIAL_KEY, value: JSON.stringify(false)});\n        }).catch(e => {\n          toast.present();\n          loading.dismiss();\n        });\n      } else if (this.book.extension == 'chm') {\n        console.log('chm');\n        this.httpService.downloadBookChm(encodeURI(url), name).then(async (base64) => {\n          this.myBook = base64;\n          loading.dismiss();\n          await Storage.set({key: TRIAL_KEY, value: JSON.stringify(false)});\n        }).catch(e => {\n          toast.present();\n          loading.dismiss();\n        });\n      } else if (this.book.extension == 'epub') {\n        console.log('epub');\n        this.httpService.downloadBookEpub(encodeURI(url), name).then(async (base64) => {\n          this.myBook = base64;\n          loading.dismiss();\n          await Storage.set({key: TRIAL_KEY, value: JSON.stringify(false)});\n        }).catch(e => {\n          toast.present();\n          loading.dismiss();\n        });\n      }\n    //}\n    // Pro version (Trial version commented)\n    /*else {\n      const alert = await this.alertCtrl.create({\n        header: 'خریداری نسخه کامل',\n        message: 'برای دانلود بیش از یک کتاب باید نسخه کامل خریداری شود',\n        buttons: ['باشه']\n      });\n      alert.present();\n    }*/\n  }\n\n  async addFavorites() {\n    const toast = await this.toastCtrl.create({\n      message: 'کتاب به علاقمندی‌ها اضافه شد',\n      duration: 1500\n    });\n    this.favorService.addFavor(this.book).then(() => {\n      toast.present();\n      console.log('added to storage');\n    }).catch(e => {\n      console.log('Error', e);\n    });\n\n\n\n  }\n\n  async share() {\n    await Share.share({\n      text: `به شما کتاب زیر با عنوان: ${this.book.title} - نویسنده: ${this.book.author} - زبان: ${this.book.language} - فرمت: ${this.book.extension}در این اپلیکیشن پیشنهاد شده است`,\n      url: 'https://cafebazaar.ir/app/ir.mohammad.malekzad.ketabyablite'\n    });\n  }\n\n}\n","import {Injectable} from '@angular/core';\nimport {HttpClient, HttpEventType} from '@angular/common/http';\nimport {FileOpener} from '@ionic-native/file-opener/ngx';\nimport {Directory, Filesystem} from '@capacitor/filesystem';\nimport {Storage} from '@capacitor/storage';\n\nexport const BOOK_KEY = 'book';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadBookService {\n  downloadProgress = 0;\n  myBooks = [];\n\n  constructor(private http: HttpClient, private fileOpener: FileOpener) { }\n\n  downloadBook(url) {\n    const proxyUrl = url;\n    return this.http.get(proxyUrl, {\n      responseType: 'blob',\n      reportProgress: true,\n      observe: 'events'\n    }).subscribe(async (event) => {\n      if (event.type === HttpEventType.DownloadProgress ) {\n        this.downloadProgress = Math.round(100 * (event.loaded/event.total));\n      } else if (event.type === HttpEventType.Response) {\n        this.downloadProgress = 0;\n        const name = `${Date.now()}`;\n        const base64 = await this.convertBlobToBase64(event.body) as string;\n        const savedFile = await Filesystem.writeFile({\n          path: name,\n          data: base64,\n          directory: Directory.Documents\n        });\n        const path = savedFile.uri;\n        const mimeType = this.getMimeType(name);\n        this.fileOpener.open(path,mimeType).then(() => {\n          console.log('File Opened');\n        }).catch((err) => {\n          console.log('error in opening file', err);\n        });\n        this.myBooks.unshift(path);\n        await Storage.set({key: BOOK_KEY, value: JSON.stringify(this.myBooks)});\n      }\n    });\n  }\n\n  public convertBlobToBase64 = (blob: Blob) => new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = reject;\n    reader.onload = () => {\n      resolve(reader.result);\n    };\n    reader.readAsDataURL(blob);\n  });\n\n  public getMimeType(name) {\n    if (name.indexOf('pdf') >= 0) {\n      return 'application/pdf';\n    } else if (name.indexOf('chm') >= 0) {\n      return 'application/chm';\n    }\n  }\n\n\n\n\n\n\n}\n","export default \".set-icon {\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n}\\n\\n.set-size {\\n  height: 100px;\\n  width: 100px;\\n  color: var(--ion-color-tertiary);\\n}\\n\\nimg {\\n  border: 2px solid var(--ion-color-primary);\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRldGFpbC1ib29rLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGFBQUE7RUFDQSx1QkFBQTtFQUNBLG1CQUFBO0FBQ0Y7O0FBQ0E7RUFDRSxhQUFBO0VBQ0EsWUFBQTtFQUNBLGdDQUFBO0FBRUY7O0FBQ0E7RUFDRSwwQ0FBQTtBQUVGIiwiZmlsZSI6ImRldGFpbC1ib29rLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi5zZXQtaWNvbiB7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xufVxuLnNldC1zaXplIHtcbiAgaGVpZ2h0OiAxMDBweDtcbiAgd2lkdGg6IDEwMHB4O1xuICBjb2xvcjogdmFyKC0taW9uLWNvbG9yLXRlcnRpYXJ5KTtcbn1cblxuaW1nIHtcbiAgYm9yZGVyOiAycHggc29saWQgdmFyKC0taW9uLWNvbG9yLXByaW1hcnkpO1xufVxuIl19 */\";","export default \"<ion-header>\\n  <ion-toolbar color=\\\"tertiary\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button defaultHref=\\\"/search/detail\\\"></ion-back-button>\\n    </ion-buttons>\\n    <ion-title>اطلاعات کتاب و دانلود</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content class=\\\"ion-padding\\\">\\n  <div *ngIf=\\\"isLoading\\\" class=\\\"ion-text-center\\\">\\n    <ion-spinner color=\\\"primary\\\"></ion-spinner>\\n  </div>\\n  <ion-grid *ngIf=\\\"!isLoading\\\">\\n    <ion-row>\\n      <ion-col size-sm = 12 size-md=\\\"8\\\" offset-md = \\\"2\\\" class=\\\"ion-text-center\\\">\\n        <img [src]=\\\"myImage\\\" *ngIf=\\\"myImage\\\">\\n      </ion-col>\\n    </ion-row>\\n    <ion-row class=\\\"ion-justify-content-center\\\">\\n      <ion-col class=\\\"set-icon\\\" size=\\\"12\\\">\\n        <ion-item [hidden]=\\\"myImage\\\"  lines=\\\"none\\\">\\n          <ion-icon name=\\\"book-sharp\\\" class=\\\"set-size\\\"></ion-icon>\\n        </ion-item>\\n      </ion-col>\\n    </ion-row>\\n    <ion-row>\\n      <ion-col size-sm = 12 size-md=\\\"8\\\" offset-md = \\\"2\\\">\\n        <ion-item lines=\\\"none\\\">\\n          <ion-icon name=\\\"reorder-four\\\"></ion-icon>\\n          <ion-label><h2>عنوان:</h2></ion-label>\\n        </ion-item>\\n        <ion-item dir=\\\"ltr\\\" lines=\\\"full\\\">\\n          <ion-text>{{book.title}}</ion-text>\\n        </ion-item>\\n      </ion-col>\\n    </ion-row>\\n    <ion-row>\\n      <ion-col size-sm = 12 size-md=\\\"8\\\" offset-md = \\\"2\\\">\\n        <ion-item lines=\\\"none\\\">\\n          <ion-icon name=\\\"clipboard-outline\\\"></ion-icon>\\n          <ion-label><h2>نویسنده :</h2></ion-label>\\n        </ion-item>\\n        <ion-item dir=\\\"ltr\\\" lines=\\\"full\\\">\\n          <ion-text>{{book.author}}</ion-text>\\n        </ion-item>\\n      </ion-col>\\n    </ion-row>\\n\\n    <ion-row>\\n      <ion-col size-sm = 12 size-md=\\\"8\\\" offset-md = \\\"2\\\">\\n        <ion-item lines=\\\"none\\\">\\n          <ion-icon name=\\\"language-outline\\\"></ion-icon>\\n          <ion-label><h2>زبان کتاب :</h2></ion-label>\\n        </ion-item>\\n        <ion-item dir=\\\"ltr\\\" lines=\\\"full\\\">\\n          <ion-text>{{book.language}}</ion-text>\\n        </ion-item>\\n      </ion-col>\\n    </ion-row>\\n    <ion-row>\\n      <ion-col size-sm = 12 size-md=\\\"8\\\" offset-md = \\\"2\\\">\\n        <ion-item lines=\\\"none\\\">\\n          <ion-icon name=\\\"expand-outline\\\"></ion-icon>\\n          <ion-label><h2>حجم فایل :</h2></ion-label>\\n        </ion-item>\\n        <ion-item dir=\\\"ltr\\\" lines=\\\"full\\\">\\n          <ion-text>{{book.filesize}}</ion-text>\\n        </ion-item>\\n      </ion-col>\\n    </ion-row>\\n    <ion-row>\\n      <ion-col size-sm = 12 size-md=\\\"8\\\" offset-md = \\\"2\\\">\\n        <ion-item lines=\\\"none\\\">\\n          <ion-icon name=\\\"apps-outline\\\"></ion-icon>\\n          <ion-label><h2>فرمت فایل:</h2></ion-label>\\n        </ion-item>\\n        <ion-item dir=\\\"ltr\\\" lines=\\\"full\\\">\\n          <ion-text>{{book.extension}}</ion-text>\\n        </ion-item>\\n      </ion-col>\\n    </ion-row>\\n\\n  </ion-grid>\\n\\n\\n\\n\\n  <ion-button (click)=\\\"downloadFile(this.book.bookImage)\\\" expand=\\\"block\\\" shape=\\\"round\\\" color=\\\"tertiary\\\" class=\\\"ion-margin\\\" [disabled]=\\\"myImage\\\" >مشاهده عکس کتاب</ion-button>\\n  <ion-button (click)=\\\"download(this.book.download, this.book.title)\\\" expand=\\\"block\\\" shape=\\\"round\\\" color=\\\"tertiary\\\" class=\\\"ion-margin\\\">دانلود کتاب</ion-button>\\n\\n  <ion-fab vertical=\\\"bottom\\\" horizontal=\\\"start\\\" slot=\\\"fixed\\\">\\n    <ion-fab-button color=\\\"danger\\\" (click)=\\\"addFavorites()\\\">\\n      <ion-icon name=\\\"heart\\\"></ion-icon>\\n    </ion-fab-button>\\n  </ion-fab>\\n\\n  <ion-fab vertical=\\\"bottom\\\" horizontal=\\\"end\\\" slot=\\\"fixed\\\">\\n    <ion-fab-button color=\\\"success\\\" (click)=\\\"share()\\\">\\n      <ion-icon name=\\\"share\\\"></ion-icon>\\n    </ion-fab-button>\\n  </ion-fab>\\n</ion-content>\\n\";"]}